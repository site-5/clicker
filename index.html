<!DOCTYPE html>
<html>
<head>
    <title>Simple Clicker</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
</head>
<body class="bg-black text-white flex items-center justify-center min-h-screen font-sans">

    <!-- SCREEN 1: WHO ARE YOU? -->
    <div id="login-screen" class="text-center">
        <h1 class="text-4xl font-bold mb-10">Select Your Player</h1>
        <div class="flex gap-4">
            <button onclick="pick('Derrick')" class="bg-blue-600 hover:bg-blue-500 px-10 py-6 rounded-2xl text-2xl font-bold transition-transform active:scale-90">
                Derrick
            </button>
            <button onclick="pick('Grace')" class="bg-pink-600 hover:bg-pink-500 px-10 py-6 rounded-2xl text-2xl font-bold transition-transform active:scale-90">
                Grace
            </button>
        </div>
    </div>

    <!-- SCREEN 2: THE GAME -->
    <div id="game-screen" class="hidden text-center">
        <div class="mb-10 uppercase tracking-widest text-gray-500 font-bold" id="player-tag"></div>
        
        <h1 id="count" class="text-9xl font-black mb-10 text-yellow-400">0</h1>
        
        <button onclick="clickIt()" class="w-64 h-64 bg-white text-black rounded-full text-4xl font-black shadow-[0_0_50px_rgba(255,255,255,0.3)] active:scale-95 transition-all">
            CLICK
        </button>
        
        <div class="mt-16 border-t border-white/10 pt-8">
            <p class="text-xs text-gray-500 uppercase font-bold">Last Clicker</p>
            <p id="who" class="text-3xl font-bold text-gray-300">...</p>
        </div>
    </div>

    <script>
        // CONFIG
        const SB_URL = 'https://dhtqvsdojuoxzfewtxld.supabase.co';
        const SB_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImRodHF2c2RvanVveHpmZXd0eGxkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjgxNTkxMzQsImV4cCI6MjA4MzczNTEzNH0.MAcxrDMZQ20kQXv-nk3zvNGMQlP9-BR97UYT5p_W7Fg';
        const supabase = window.supabase.createClient(SB_URL, SB_KEY);

        let myName = "";

        // ACTION: PICK NAME
        function pick(name) {
            myName = name;
            
            // Immediately switch UI
            document.getElementById('login-screen').classList.add('hidden');
            document.getElementById('game-screen').classList.remove('hidden');
            document.getElementById('player-tag').innerText = "Playing as " + myName;

            // Start background sync
            init();
        }

        async function init() {
            // Load initial score
            const { data } = await supabase.from('clicker_data').select('*').single();
            if(data) refresh(data);

            // Listen for others clicking
            supabase.channel('clicks')
            .on('postgres_changes', { event: 'UPDATE', schema: 'public', table: 'clicker_data' }, p => refresh(p.new))
            .subscribe();
        }

        async function clickIt() {
            // Visual fake increment for instant feel
            const countEl = document.getElementById('count');
            countEl.innerText = parseInt(countEl.innerText) + 1;

            // Send to DB
            await supabase.rpc('increment_simple', { p_name: myName });
        }

        function refresh(data) {
            document.getElementById('count').innerText = data.total_clicks;
            document.getElementById('who').innerText = data.last_person;
        }
    </script>
</body>
</html>
