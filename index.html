<!DOCTYPE html>
<html>
<head>
    <title>Simple Clicker</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
</head>
<body class="bg-slate-900 text-white flex items-center justify-center min-h-screen">

    <!-- Screen 1: Name Entry -->
    <div id="login" class="text-center p-10 bg-slate-800 rounded-3xl shadow-2xl">
        <h1 class="text-3xl font-bold mb-6 text-blue-400">Who are you?</h1>
        <input id="name-input" type="text" class="bg-slate-700 p-3 rounded-lg block w-full mb-4 outline-none focus:ring-2 ring-blue-500">
        <button onclick="enter()" class="bg-blue-600 w-full py-3 rounded-lg font-bold hover:bg-blue-500">Go</button>
    </div>

    <!-- Screen 2: The Button -->
    <div id="game" class="hidden text-center">
        <h1 id="count" class="text-8xl font-black mb-2 text-blue-400">0</h1>
        <p class="text-slate-400 mb-10">Total Global Clicks</p>
        
        <button onclick="doClick()" class="bg-blue-600 w-48 h-48 rounded-full text-4xl font-bold shadow-lg shadow-blue-900/50 active:scale-95 transition-transform">CLICK</button>
        
        <div class="mt-12 bg-slate-800 p-6 rounded-2xl">
            <p class="text-xs font-bold uppercase tracking-tighter text-slate-500">Last Click Performed By</p>
            <p id="last-person" class="text-2xl font-bold text-white">Connecting...</p>
        </div>
    </div>

    <script>
        const SB_URL = 'https://dhtqvsdojuoxzfewtxld.supabase.co';
        const SB_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImRodHF2c2RvanVveHpmZXd0eGxkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjgxNTkxMzQsImV4cCI6MjA4MzczNTEzNH0.MAcxrDMZQ20kQXv-nk3zvNGMQlP9-BR97UYT5p_W7Fg';
        const supabase = window.supabase.createClient(SB_URL, SB_KEY);

        let myName = "";
        let currentClicks = 0;

        function enter() {
            myName = document.getElementById('name-input').value.trim();
            if(!myName) return;
            document.getElementById('login').style.display = 'none';
            document.getElementById('game').style.display = 'block';
            init();
        }

        async function init() {
            // 1. Get initial data
            const { data } = await supabase.from('clicker_data').select('*').single();
            updateUI(data);

            // 2. Listen for other people's clicks
            supabase.channel('room1')
            .on('postgres_changes', { event: 'UPDATE', schema: 'public', table: 'clicker_data' }, payload => {
                updateUI(payload.new);
            }).subscribe();
        }

        async function doClick() {
            // Update locally first for speed
            currentClicks++;
            document.getElementById('count').innerText = currentClicks;
            
            // Push to Supabase
            await supabase.from('clicker_data')
                .update({ total_clicks: currentClicks, last_person: myName })
                .eq('id', 1);
        }

        function updateUI(data) {
            if(!data) return;
            currentClicks = data.total_clicks;
            document.getElementById('count').innerText = currentClicks;
            document.getElementById('last-person').innerText = data.last_person;
        }
    </script>
</body>
</html>
