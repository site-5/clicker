<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Global Clicker</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        body { display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100vh; font-family: sans-serif; background: #f0f2f5; }
        #counter { font-size: 5rem; margin-bottom: 20px; color: #1e293b; }
        button { padding: 15px 40px; font-size: 1.5rem; cursor: pointer; background: #3b82f6; color: white; border: none; border-radius: 8px; transition: transform 0.1s; }
        button:active { transform: scale(0.95); }
    </style>
</head>
<body>
    <div id="counter">loading...</div>
    <button id="click-btn">CLICK ME</button>

    <script>
        const SUPABASE_URL = 'https://dhtqvsdojuoxzfewtxld.supabase.co';
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImRodHF2c2RvanVveHpmZXd0eGxkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjgxNTkxMzQsImV4cCI6MjA4MzczNTEzNH0.MAcxrDMZQ20kQXv-nk3zvNGMQlP9-BR97UYT5p_W7Fg';
        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

        const counterDisplay = document.getElementById('counter');
        const clickBtn = document.getElementById('click-btn');

        async function fetchCount() {
            const { data } = await supabase.from('clicks').select('count').eq('id', 1).single();
            if (data) counterDisplay.innerText = data.count;
        }

        async function incrementCount() {
            // Using a simple update for demonstration. 
            // In production, an RPC (Database Function) is better to handle concurrency.
            const current = parseInt(counterDisplay.innerText);
            await supabase.from('clicks').update({ count: current + 1 }).eq('id', 1);
        }

        // Subscribe to real-time changes
        supabase.channel('clicks-channel')
            .on('postgres_changes', { event: 'UPDATE', schema: 'public', table: 'clicks' }, payload => {
                counterDisplay.innerText = payload.new.count;
            })
            .subscribe();

        clickBtn.addEventListener('click', incrementCount);
        fetchCount();
    </script>
</body>
</html>
